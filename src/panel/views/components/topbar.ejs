<!-- =========================
     HEADER / TOPBAR
     Arquivo único
     ========================= -->

<header class="flex items-center justify-between h-16 px-6 bg-gray-900 border-b border-gray-700">

    <!-- Lado esquerdo (reservado p/ breadcrumbs ou search) -->
    <div></div>

    <!-- Lado direito -->
    <div class="flex items-center">

        <!-- Toggle Dark / Light -->
        <button 
            @click="toggleTheme()" 
            class="mr-4 text-gray-400 hover:text-white focus:outline-none"
            title="Alternar tema"
        >
            <!-- Dark -->
            <template x-if="theme === 'dark'">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 3v1m0 16v1m9-9h-1M4 12H3
                           m15.364 6.364l-.707-.707
                           M6.343 6.343l-.707-.707
                           m12.728 0l-.707.707
                           M6.343 17.657l-.707.707
                           M16 12a4 4 0 11-8 0 4 4 0 018 0z"
                    />
                </svg>
            </template>

            <!-- Light -->
            <template x-if="theme === 'light'">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M20.354 15.354A9 9 0 018.646 3.646
                           9.003 9.003 0 0012 21
                           a9.003 9.003 0 008.354-5.646z"
                    />
                </svg>
            </template>
        </button>

        <% if (user) { %>
        <!-- Menu do Usuário -->
        <div x-data="{ open: false }" class="relative">

            <!-- Botão principal -->
            <button 
                @click="open = !open"
                class="flex items-center space-x-2 focus:outline-none"
            >
                <!-- Username -->
                <span class="text-sm font-medium text-gray-300">
                    <%= user.username %>
                </span>

                <!-- Plano -->
                <% 
                    let planClass = 'bg-gray-600';
                    if (user.plan === 'monthly') planClass = 'bg-green-500';
                    if (user.plan === 'weekly') planClass = 'bg-yellow-500';
                    if (user.plan === 'test') planClass = 'bg-blue-500';
                %>
                <span class="px-2 py-0.5 text-xs font-semibold text-white rounded-full <%= planClass %>">
                    <%= user.plan || 'Sem plano' %>
                </span>

                <!-- Status -->
                <% if (user.suspended) { %>
                    <span class="px-2 py-0.5 text-xs font-semibold text-white bg-red-600 rounded-full">
                        Suspenso
                    </span>
                <% } else { %>
                    <span class="px-2 py-0.5 text-xs font-semibold text-white bg-green-600 rounded-full">
                        Ativo
                    </span>
                <% } %>

                <!-- Chevron -->
                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M19 9l-7 7-7-7"
                    />
                </svg>
            </button>

            <!-- Dropdown -->
            <div 
                x-show="open"
                @click.away="open = false"
                x-cloak
                class="absolute right-0 z-30 w-48 py-2 mt-2 bg-gray-800 rounded-md shadow-xl"
            >
                <div class="px-4 py-2 text-xs text-gray-400">
                    Conta
                </div>

                <form action="/logout" method="POST">
                    <button 
                        type="submit"
                        class="block w-full px-4 py-2 text-sm text-left text-gray-300 hover:bg-gray-700 hover:text-white"
                    >
                        Sair
                    </button>
                </form>
            </div>

        </div>
        <% } %>

    </div>
</header>

<!-- =========================
     SCRIPT DO TEMA
     ========================= -->
<script>
document.addEventListener('alpine:init', () => {
    Alpine.store('theme', {
        current: localStorage.getItem('theme') || 'dark',

        init() {
            this.apply();
        },

        toggleTheme() {
            this.current = this.current === 'dark' ? 'light' : 'dark';
            localStorage.setItem('theme', this.current);
            this.apply();
        },

        apply() {
            document.documentElement.classList.toggle(
                'dark',
                this.current === 'dark'
            );
        }
    });

    Alpine.store('theme').apply();
});
</script>
